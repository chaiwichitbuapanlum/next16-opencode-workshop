# การเรียนรู้ Next.js 16 และ Cache Components

เอกสารนี้อธิบายการทำงานและการใช้งานโปรเจค Next.js 16 ที่ใช้ฟีเจอร์ Cache Components เพื่อเพิ่มประสิทธิภาพในการแสดงผลเว็บไซต์

## สารบัญ

1. [ภาพรวมโปรเจค](#ภาพรวมโปรเจค)
2. [โครงสร้างโปรเจค](#โครงสร้างโปรเจค)
3. [การตั้งค่า Next.js 16](#การตั้งค่า-nextjs-16)
4. [การใช้งาน Cache Components](#การใช้งาน-cache-components)
5. [API Services](#api-services)
6. [การรัน Development Server](#การรัน-development-server)
7. [แนวทางการพัฒนาต่อ](#แนวทางการพัฒนาต่อ)

## ภาพรวมโปรเจค

โปรเจคนี้เป็นตัวอย่างการใช้งาน Next.js 16 ที่แสดงวิธีการแสดงรายการคอร์สเรียนและรายชื่อผู้ใช้ โดยใช้ฟีเจอร์ Cache Components เพื่อเพิ่มประสิทธิภาพในการโหลดหน้าเว็บ โดยแบ่งการแสดงผลเป็น:

1. **Static Content** - เนื้อหาที่ไม่เปลี่ยนแปลง จะถูก pre-render ตอนสร้าง build
2. **Cached Dynamic Content** - เนื้อหาที่เปลี่ยนแปลงไม่บ่อย จะใช้ `use cache` กับ `cacheLife`
3. **Dynamic Content** - เนื้อหาที่ต้องการความสดใหม่ จะใช้ React Suspense เพื่อโหลดข้อมูลแบบ streaming

## โครงสร้างโปรเจค

โครงสร้างโฟลเดอร์หลักของโปรเจคมีดังนี้:

```
app/                 # App Router ของ Next.js
  about/             # หน้า about
  course/            # หน้าแสดงรายการคอร์ส
    [id]/            # หน้าแสดงรายละเอียดคอร์สตาม ID
      page.tsx       # คอมโพเนนต์แสดงรายละเอียดคอร์ส
      loading.tsx    # UI ขณะโหลด
    page.tsx         # หน้าแสดงรายการคอร์สทั้งหมด
  user/              # หน้าแสดงข้อมูลผู้ใช้
  page.tsx           # หน้าแรกของเว็บไซต์
components/          # คอมโพเนนต์ที่นำมาใช้ซ้ำ
  ui/                # UI components จาก shadcn/ui
  AppCourseList.tsx  # คอมโพเนนต์แสดงรายการคอร์ส
  AppUserList.tsx    # คอมโพเนนต์แสดงรายการผู้ใช้
  hero.tsx           # คอมโพเนนต์ Hero section
  navbar.tsx         # แถบนำทาง
lib/                 # โค้ดที่ใช้ร่วมกัน
  types.ts           # ไฟล์กำหนด Type ต่างๆ
  utils.ts           # Utility functions
services/            # Service สำหรับเรียกใช้ API
  course-service.ts  # Service สำหรับข้อมูลคอร์ส
  user-service.ts    # Service สำหรับข้อมูลผู้ใช้
```

## การตั้งค่า Next.js 16

โปรเจคนี้ใช้ Next.js 16 ซึ่งมีการเปิดใช้งานฟีเจอร์ Cache Components ใน `next.config.ts`:

```typescript
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  /* config options here */
  cacheComponents: true, // เปิดใช้งาน Cache Components
  logging: {
    fetches: {
      fullUrl: true,
    },
  },
};

export default nextConfig;
```

## การใช้งาน Cache Components

Cache Components ใน Next.js 16 ช่วยให้สามารถผสมผสานการแสดงผลแบบ static, cached และ dynamic ในหน้าเดียวกัน โดยในโปรเจคนี้มีตัวอย่างการใช้งานดังนี้:

### 1. Static Content

เนื้อหาที่ไม่ต้องการข้อมูลจาก API จะถูก pre-render อัตโนมัติเมื่อ build โปรเจค เช่น Navbar หรือส่วนที่เป็น UI คงที่

### 2. Cached Dynamic Content ด้วย `use cache`

ใช้กับข้อมูลที่เปลี่ยนแปลงไม่บ่อย แต่ต้องดึงจาก API เช่น ข้อมูลผู้ใช้ใน `user-service.ts`:

```typescript
export async function getUsers(): Promise<User[]> {
  "use cache";
  cacheLife("minutes");

  try {
    const response = await fetch(API_URL);

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data;
  } catch (error) {
    console.error("Error fetching courses:", error);
    throw error;
  }
}
```

โค้ดนี้จะทำการแคชผลลัพธ์ไว้เป็นเวลาหลายนาที ตามที่กำหนดใน `cacheLife('minutes')` เพื่อลดการเรียก API ซ้ำ

### 3. Dynamic Content ด้วย React Suspense

ใช้กับข้อมูลที่ต้องการความสดใหม่ทุกครั้งที่เรียกใช้ โดยใช้ React Suspense เพื่อแสดง loading state ระหว่างรอข้อมูล เช่นในไฟล์ `app/course/page.tsx`:

```tsx
export default async function CoursePage() {
  return (
    <div className="h-full max-w-7xl mx-auto px-4 mt-4">
      <AppUserList />

      <Suspense fallback={<Spinner />}>
        <AppCourseList />
      </Suspense>
    </div>
  );
}
```

ในตัวอย่างนี้:

- `AppUserList` เป็นคอมโพเนนต์ที่ใช้ `use cache` จึงถูกรวมใน static shell
- `AppCourseList` ถูกห่อด้วย `<Suspense>` และจะโหลดข้อมูลแบบ dynamic ที่ runtime

## API Services

โปรเจคนี้มีการเรียกใช้ API จาก 2 service หลัก:

### 1. Course Service (`services/course-service.ts`)

```typescript
import { Course } from "@/lib/types";

const API_URL = "https://6920694231e684d7bfccf095.mockapi.io/api/v1/course";

export async function getCourses(): Promise<Course[]> {
  try {
    const response = await fetch(API_URL);
    // ... ดึงข้อมูลคอร์สทั้งหมด
    return data;
  } catch (error) {
    // ... จัดการ error
  }
}

export async function getCourseById(id: string): Promise<Course> {
  try {
    // ... ดึงข้อมูลคอร์สตาม ID
    return data;
  } catch (error) {
    // ... จัดการ error
  }
}
```

### 2. User Service (`services/user-service.ts`)

```typescript
import { User } from "@/lib/types";
import { cacheLife } from "next/cache";

const API_URL = "https://6920694231e684d7bfccf095.mockapi.io/api/v1/user";

export async function getUsers(): Promise<User[]> {
  "use cache";
  cacheLife("minutes");

  try {
    // ... ดึงข้อมูลผู้ใช้ทั้งหมดและแคชไว้
    return data;
  } catch (error) {
    // ... จัดการ error
  }
}
```

## การรัน Development Server

เพื่อเริ่มพัฒนาโปรเจคนี้ ให้รันคำสั่งต่อไปนี้:

```bash
# ติดตั้ง dependencies
npm install

# รัน development server
npm run dev
```

เมื่อรันแล้วจะสามารถเข้าถึงเว็บไซต์ได้ที่ http://localhost:3000

## แนวทางการพัฒนาต่อ

การพัฒนาต่อยอดโปรเจคนี้สามารถทำได้หลายแนวทาง:

1. **เพิ่มฟีเจอร์ cacheTag** - สำหรับการล้าง cache ที่เฉพาะเจาะจงหลังจากข้อมูลมีการเปลี่ยนแปลง
2. **ใช้ cacheLife แบบปรับแต่งได้** - กำหนดเวลาแคชที่แตกต่างกันสำหรับข้อมูลประเภทต่างๆ
3. **เพิ่ม Form Handling** - สร้างฟอร์มสำหรับเพิ่ม แก้ไข หรือลบคอร์สเรียน
4. **เพิ่มความปลอดภัย** - เพิ่มระบบ Authentication และ Authorization
5. **ปรับปรุง UI/UX** - พัฒนา UI เพิ่มเติมให้สวยงามและใช้งานง่าย
6. **เพิ่ม Error Handling** - ปรับปรุงการจัดการข้อผิดพลาดให้ครอบคลุมมากขึ้น

---

เอกสารนี้จัดทำขึ้นเพื่อช่วยให้ผู้ที่สนใจศึกษา Next.js 16 และฟีเจอร์ Cache Components สามารถเข้าใจโครงสร้างและการทำงานของโปรเจคตัวอย่างนี้ได้อย่างรวดเร็ว
